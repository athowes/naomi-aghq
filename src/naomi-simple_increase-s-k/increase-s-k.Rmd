---
title: "How does increasing $s$ and $k$ effect log normalising constant estimation"
author:
- name: Adam Howes
output:
  bookdown::html_document2:
    toc: yes
    toc_float: yes
    toc_collapsed: yes
    df_print: paged
    code_folding: show
    theme: lumen
abstract: |
  **Background** We have fit the Naomi model with a range of grids.
  
  **Task** How does changing the number of points per dimension $k$, or the number of dimensions of variation kept $s$ change the log normalising constant estimated?
---

# Data import

We start by reading in a selection of fitted PCA-AGHQ models.
We only need the quadrature part of the returned object:

```{r}
read_sk <- function(s, k) {
  assign(paste0("s", s, "k", k), readRDS(paste0("depends/aghq-s", s, "-k", k, ".rds"))$quad, envir = parent.frame())
}

read_sk(s = 1, k = 2)
read_sk(s = 2, k = 2)
read_sk(s = 3, k = 2)
read_sk(s = 4, k = 2)
read_sk(s = 5, k = 2)

read_sk(s = 1, k = 3)
read_sk(s = 2, k = 3)
read_sk(s = 3, k = 3)
read_sk(s = 4, k = 3)
read_sk(s = 5, k = 3)
```

Check that a few of the runs have the correct number of grid points:

```{r}
stopifnot(nrow(s5k2$modesandhessians) == 2^5)
stopifnot(nrow(s3k3$modesandhessians) == 3^3)
```

# Table processing

```{r}
lognormconsts <- c(
  s1k2$normalized_posterior$lognormconst,
  s2k2$normalized_posterior$lognormconst,
  s3k2$normalized_posterior$lognormconst,
  s4k2$normalized_posterior$lognormconst,
  s5k2$normalized_posterior$lognormconst
)

df <- data.frame(
  s = 1:5,
  k = 2,
  lognormconst = lognormconsts
)

write_csv(df, "increase-s-k.csv")
```

# Visualisation

```{r}
ggplot(df, aes(x = s, y = lognormconst)) +
  geom_point() +
  facet_grid(k ~ .) +
  labs(x = "Dimensions kept of the PCA", y = "Log normalising constant") +
  theme_minimal()
```
